#summary Design Document for Twitter-like Application Built on Hypertable

= Introduction =

This document describes how a simple Twitter-like application can be built on Hypertable.  It's a stripped down version of Twitter that contains a user's tweet stream as well as a pane containing current user information (number of tweets, latest tweet, following, and followers).

= Details =

== Tables ==

=== Table: `profile` ===

_rowkey:  username_

{{{
CREATE TABLE profile (
  guid,
  'display_name',
  password,
  avatar,
  bio,
  url
);
}}}

This table contains profile information for each user.

=== Table: `username` ===

_rowkey:  username_

{{{
CREATE TABLE 'username' (
  guid
);
}}}

This table is used to register new usernames.  We will provide an API that allows you to atomically insert a column, if it does not already exists, and return the column value.  Something along the lines of:

{{{
$guid = 627918273726
$old_guid = INSERT_ONCE_RETURN INTO username ("joe", "guid", "$guid")
}}}

This API will be used to update this table so that two users don't end up getting assigned the same username.

=== Table: `user` ===

_rowkey: username_

{{{
CREATE TABLE user (
  following MAX_VERSIONS=1,
  'following_history',
  followers MAX_VERSIONS=1,
  'followers_history',
  'follow_stream',
  'follow_stream_count' COUNTER,
  'my_stream',
  'my_stream_counter' COUNTER
);
}}}



=== Table: `tweet` ===

_rowkey: username+timestamp_milliseconds_

{{{
CREATE TABLE tweet (
  message
);
}}}

== Actions ==

=== Register New User ===

The first step of this action is to find a unique username

{{{
$username = /* ask user for username */
$guid = 627918273726
$old_guid = 0
while ($guid != $old_guid) {
  if ($old_guid != 0) {
    /* report error; ask user for new username */
  }
  $old_guid = INSERT_ONCE_RETURN INTO username ($username, "guid", "$guid")
}
}}}

=== Follow ===



=== Unfollow ===

=== Tweet ===

== Rendering ==

=== User Information ===

=== Tweet Stream ===

=== Other Users's Recent Tweets ===